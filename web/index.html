<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta content="IE=Edge" http-equiv="X-UA-Compatible" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Flutter Web App" />

    <title>Flutter Web App</title>

    <!-- Optimized preloads -->
    <link rel="preload" href="main.dart.js" as="script">
    <link rel="icon" href="favicon.png" type="image/png">

    <!-- Styles -->
    <style>
        html, body {
          height: 100%;
          margin: 0;
          background: #fafafa;
          font-family: system-ui, sans-serif;
          display: flex;
          align-items: center;
          justify-content: center;
          color: #444;
        }
        #loading {
          text-align: center;
          font-size: 1.1em;
          animation: pulse 1.2s infinite;
        }
        @keyframes pulse {
          0%, 100% { opacity: 0.6; }
          50% { opacity: 1; }
        }
    </style>
</head>

<body>
<div id="loading">üöÄ Loading Flutter App...</div>

<script>
    (async function initFlutter() {
      const start = performance.now();
      const loading = document.getElementById('loading');

      function log(...args) {
        console.log('[Flutter Init]', ...args);
      }

      try {
        log('main.dart.js preloading...');
        await fetch('main.dart.js', { method: 'HEAD' });
        log('main.dart.js preloaded');

        // Try Flutter loader if available
        if (window._flutter?.loader) {
          log('Flutter loader detected, using official loader...');
          await window._flutter.loader.loadEntrypoint({});
        } else {
          log('Loader failed, fallback triggered: Flutter loader not available');
          log('Fallback: direct script launch');

          const script = document.createElement('script');
          script.src = 'main.dart.js';
          script.defer = true;
          script.onload = () => {
            log('main.dart.js loaded successfully');
            const total = (performance.now() - start).toFixed(2);
            log('Total startup:', total, 'ms');
            loading.style.display = 'none';
          };
          script.onerror = (e) => {
            loading.textContent = '‚ùå Failed to load Flutter app';
            console.error('[Flutter Init] Load error:', e);
          };
          document.body.appendChild(script);
        }
      } catch (e) {
        console.error('[Flutter Init] Error initializing:', e);
        loading.textContent = '‚ùå Initialization failed';
      }
    })();
</script>
</body>
</html>
